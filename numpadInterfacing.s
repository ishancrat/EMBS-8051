ORG 0000H
SJMP START
ORG 0036H
;P1:0 - 3  :: A,B,C,D
;P1.4 - 7  :: 1,2,3,4


DELAY: MOV R2,#5
      HERE3: MOV R3,#250
	  HERE2: MOV R4,#250
	  HERE: DJNZ R4,HERE
	  DJNZ R3,HERE2
	  DJNZ R2,HERE3
	  MOV P2,#00H
	  RET

START: MOV P2,#00H
	   
	   SCANTOP:	MOV P1,#0FFH
				CLR P1.0
				JB P1.4,N1
				MOV P2,#00000111B
				ACALL DELAY
				N1: JB P1.5,N2
					MOV P2,#01111111B
					ACALL DELAY
					N2: JB P1.6,N3
						MOV P2,#01101111B;
						ACALL DELAY
						N3: JB P1.7,SCAN2
							MOV P2,#01011110B
							ACALL DELAY
	   SCAN2: SETB P1.0
			  CLR P1.1
			  JB P1.4,M1
			  MOV P2,#01100110B
			  ACALL DELAY
			  M1: JB P1.5,M2
				  MOV P2,#01101101B
				  ACALL DELAY
				  M2: JB P1.6,M3
					  MOV P2,#01111101B
					  ACALL DELAY
					  M3: JB P1.7,SCAN3
						  MOV P2,#01110110B
						  ACALL DELAY
	   SCAN3: SETB P1.1
			  CLR P1.2
			  JB P1.4,S1
			  MOV P2,#00000110B
			  ACALL DELAY
			  S1: JB P1.5,S2
				  MOV P2,#01011011B
				  ACALL DELAY
				  S2: JB P1.6,S3
					  MOV P2,#01001111B
					  ACALL DELAY
					  S3: JB P1.7,SCAN4
						  MOV P2,#01000000B
						  ACALL DELAY
						  
	   SCAN4: SETB P1.2 
			  CLR P1.3
			  JB P1.4,Q1
			  MOV P2,#11111111B
			  ACALL DELAY
			  Q1: JB P1.5,Q2
				  MOV P2,#00111111B
				  ACALL DELAY
				  Q2: JB P1.6,Q3
					  MOV P2,#01001000B;
					  ACALL DELAY
					  Q3: JB P1.7,SCANTOP_ROUTER
						  MOV P2,#01110011B
						  ACALL DELAY
		SCANTOP_ROUTER:LJMP SCANTOP

END
